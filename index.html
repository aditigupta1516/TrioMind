<!DOCTYPE html>
<html lang="en"></html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Data</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    
    <!-- <link rel="stylesheet" href="style.css"> -->
    <style>:root{
    --primary-color:#005b96;
    --secondary-color:#00a8e8;
    --accent-color:#ff6b6b;
    --light-color:#f8f9fa;
    --dark-color:#212529;
    --success-color:#28a745;
    --warning-color:#ffc107;
    --danger-color:#dc3545;
}

body{
    font-family:  'Roboto', sans-serif;
    background: linear-gradient(135deg,#f5f7fa 0%, #c3cfe2 100%);
    margin: 0;
    padding: 0;
    color: var(--dark-color);
    min-height:100vh;
    overflow-x:hidden;
}
header{
    background:linear-gradient(to right,var(--primary-color),var(--secondary-color));
    color:white;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    position: relative;
}
h1{
    margin:0;
    font-weight:600;
    letter-spacing:0.5px;
}
.control-panel{
    display:flex;
    justify-content:center;
    gap: 1rem;
    margin-top:1rem;
    flex-wrap:wrap;
}
.control-btn{
    padding:0.75rem 1.5rem;
    background-color :rgba(255,255,255,0.2);
    border:2px solid white;
    color:white;
    font-size:1rem;
    border-radius:50px;
    cursor:pointer;
    transition:all 0.3s ease;
    font-weight:500;
    display:flex;
    align-items:center;
    gap:0.5rem;
}
.control-btn:hover{
    background-color:rgba(255,255,255,0.3);
    transform:translateY(-2px);
}
.control-btn.active{
    background-color:white;
    color:var(--primary-color);
    box-shadow :0 0 15px rgba(255,255,255,0.7);
}
.control-btn i{
    font-size: 1.2rem;
}

main{
    padding:2rem;
    display:flex;
    justify-content : center;
    min-height : calc(100vh - 200px);
}
.patient-info{
    text-align:center;
    margin-bottom:1.5rem;
}
.patient-avatar{
    width:80px;
    height:80px;
    border-radius:50%;
    object-fit:cover;
    border:3px solid var(--secondary-color);
    margin: 0 auto 1rem;
}
.patient-name{
    font-size:1.2rem;
    font-weight:600;
    margin:0.5rem 0;
}
.patient-id{
    font-size:0.9rem;
    color:#666;
    margin:0;
}
.nav-menu{
    list-style:none;
    padding:0;
    margin:0;
}
.data-container{
    width: 90%;
    max-width: 1200px;
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 2rem;

}

.sidebar{
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    height: fit-content;
}
.nav-item{
    padding: 0.8rem 0.1rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.8rem;
    transition: all 0.3s ease;
}

.nav-item:hover{
    background-color: rgba(0,168, 232, 0.1);
    transform: translateX(5px);
}

.nav-item.active{
    background-color: var(--secondary-color) ;
    color: white;
    font-weight: 500;
}

.nav-item[data-section="emergency"]{
    color: var(--danger-color);
}

.nav-item[data-section="emergency"].active{
    background-color: var(--danger-color);
}
.nav-item i{ 
    font-size: 1.1rem;
}


.data-section{
    display:none;
    background: white;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    animation: fadeIn 0.5s ease;
}

.data-section.active{
    display:block;
}

@keyframes fadeIn{
    from{opacity:0; transform: translateY(10px);
    }
    to {opacity: 1; transform: translateY(0);}
}

.section-header{
    color: var(--primary-color);
    margin-bottom: 1.5rem;
    margin-top: 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #eee;

}
.data-grid{
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;

}
.data-card{
    background: #f8f9fa;
    border-radius: 10px;
    padding: 1.5rem ;
    border-left: 4px solid var(--secondary-color);
    box-shadow: 0 3px 10px rgba(0,0,0,0.05) ;
    transition: all 0.3s ease ;
}
.data-card:hover{
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.card-title{
    font-weight: 600;
    margin-top: 0;
    margin-bottom: 0.5rem;
    color: var(--primary-color);
    font-size: 1rem;
}
.card-value{
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0;
    color: var(--dark-color);
}
.card-unit{
    font-size: 0.9rem;
    color: #666;
}

.medication-list{
    list-style: none;
    padding: 0;
}
.medication-item{
    background:#f8f9fa ;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.medication-name{
    font-weight: 600;
    margin: 0;
}
.medication-details{
    color: #666;
    margin: 0.3rem 0 0;
    font-size: 0.9rem;
}
.medication-time{
    background: var(--secondary-color);
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 50px;
    font-size: 0.8rem;
    font-weight: 500;
}
.history-item{
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1rem;
}
.history-date{
    font-size:0.9rem;
    color:#666;
    margin:0 0 0.5rem;
}
.history-diagnosis{
    font-weight:600;
    margin:0 0 0.5rem;
    color:var(--primary-color);
}
.history-description{
    margin:0;
    line-height:1.5;
}
#status{
    text-align:center;
    margin:1rem auto;
    padding:0.8rem;
    border-radius:50px;
    max-width:300px;
    font-weight:500;
    background-color:rgba(0,168,232,0.1);
    color:var(--primary-color);
    transition:all 0.3s ease;
}
#gestureCam{
    position:fixed;
     right:20px;
     bottom: 20px;
     width: 200px;
     bottom:20px;
     border-radius:15px;
     box-shadow:0 5px 20px rgba(0,0,0,0.2);
     border:3px solid white;
     z-index:100;
     transform: scaleX(-1);
}
.gesture-indicator{
    position:fixed;
    right:20px;
    bottom:240px;
    background:white;
    padding:0.8rem 1.2rem;
    border-radius:50px;
    box-shadow:0 5px 0.5px rgba(0,0,0,0.1);
    font-weight:600;
    color:var(--primary-color);
    display:none;
    z-index:100;
}
.voice-indicator{
    position:fixed;
    left:20px;
    bottom :20px;
    background:white;
    padding:0.8rem 1.2rem;
    border-radius:50px;
    box-shadow:0 5px 15px rgba(0,0,0,0.1);
    font-weight:600;
    color:var(--primary-color);
    display:none;
    z-index:100;
}
.emergency-btn {
    position: fixed;
    right: 20px;
    top: 20px;
    background: var(--danger-color);
    color: white;
    border: none;
    padding: 0.8rem  1.5rem;
    border-radius: 50px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
    z-index: 100;
    transition: all 0.3s ease;
}

.emergency-btn:hover{
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(220, 53, 69, 0.5) ;
}
.emergency-card{
    text-align: center;
    padding: 2rem;
    background: rgba(220, 53, 69, 0.1);
    border: 2px dashed var(--danger-color);
    border-radius: 15px;
}
.emergency-cancel{
    margin-top: 1rem;
    padding: 0.75rem 1.5rem;
    background: white;
    border:2px solid var(--danger-color);
    color: var(--danger-color);
    border-radius: 50px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}
.emergency-cancel:hover{
    background: var(--danger-color);
    color: white;
}
@media (max-width:768px){
    .data-container{
        grid-template-columns: 1fr;
    }
    .sidebar{
        order: -1;
    }
    #gestureCam {
        width: 150px;
        right: 10px;
        bottom: 10px;
    }
    .gesture-indicator{
        bottom: 170px;
        right:10px;
    }
}

@keyframes emergencyFlash {
    0%, 100%{background-color: inherit;}
    50% {background-color: rgba(220, 53, 69, 0.3);}
}
.gesture-info{
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(255,255,255,0.9);
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    max-width: 300px;
    z-index: 100;
}
.gesture-info h3{
    margin-top: 0;
    color: var(--primary-color);
}

.gesture-info ul{
    padding-left: 20px;
}
.gesture-info li{
    margin-bottom: 8px;
}</style>

</head>
<body>
    <div id="app">
        <header>
            <h1>Patient Data Interface</h1>
            <div class="control-panel">
                <button id="voiceToggle"  class="control-btn">
                    <i class="fas fa-microphone"></i>Voice Control
                </button>
                <button id="gestureToggle" class="control-btn">
                    <i class= "fas fa-hand-paper"></i>Gesture Control
                </button>
            </div>
        </header>
                <button id="emergencyBtn" class="emergency-btn">
                <i class="fas fa-bell"></i> Emergency
                </button>
            
                <main>
                    <div class="data-container">
                        <aside class="sidebar">
                            <div class= "patient-info ">
                                <img src="https://ui-avatars.com/api/?name=John+Doe&background=005b96&color=fff" alt="Patient" class="patient-avatar">
 
                                <h3 class="patient-name">Jeffry D.</h3>
                                <p class="patient-id">PID-7353760</p>
                            </div>

                            <ul class="nav-menu">
                                <li class="nav-item active" data-section="vitals">
                                <i class="fas fa-heartbeat"></i> Vitals
                                </li>
                                <li class="nav-item" data-section="medications">
                                    <i class="fas fa-pills"></i> Medication
                                </li>
                                 <li class="nav-item" data-section="history">
                                    <i class="fas fa-history"></i> History
                                </li> <li class="nav-item" data-section="lab">
                                    <i class="fas fa-flask"></i> Lab results
                                </li>
                                 <li class="nav-item" data-section="appointments">
                                    <i class="fas fa-calendar-alt"></i> Appointments
                                </li>
                                 <li class="nav-item" data-section="emergency">
                                    <i class="fas fa-bell"></i> Emergency
                                </li>
                            </ul>
                        </aside>
                        <div class="content-area">
                            <section id="vitals" class="data-section active">
                            <h2 class="section-header">Patient Vitals</h2>
                            <div class="data-grid">
                                <div class="data-card">
                                    <h3 class="card-title">Heart Rate</h3>
                                    <p class="card-value">72 <span class="card-unit">BPM</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i> Normal</p>
                                </div>
                                <div class="data-card">
                                    <h3 class="card-title">Blood Pressure</h3>
                                    <p class="card-value">118/76 <span class="card-unit">mmHg</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i> Normal</p>
                                </div>
                                <div class="data-card">
                                    <h3 class="card-title">Temperature</h3>
                                    <p class="card-value">98.4 <span class="card-unit">°F</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i> Normal</p>
                                </div>
                                <div class="data-card">
                                    <h3 class="card-title">Oxygen Saturation</h3>
                                    <p class="card-value">98 <span class="card-unit">%</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i> Normal</p>
                                </div>
                                <div class="data-card">
                                    <h3 class="card-title">Respiratory Rate</h3>
                                    <p class="card-value">16 <span class="card-unit">breaths/min</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i> Normal</p>
                                </div>
                                <div class="data-card">
                                    <h3 class="card-title">Glucose Level</h3>
                                    <p class="card-value">102 <span class="card-unit">mg/dL</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i> Elevated</p>
                                </div>
                            </div>
                        </section>
                        <section id="medications" class="data-section">
                            <h2 class="section-header">Current Medications</h2>
                            <ul class="medication-list">
                                <li class="medication-item">
                                    <div>
                                        <h3 class="medication-name">Gluco-D3</h3>
                                        <p class="medication-details">10mg Tablet for Cholesterol management</p>
                                    </div>
                                    <span class="medication-time">Morning</span>
                                </li>
                                <li class="medication-item">
                                    <div>
                                        <h3 class="medication-name">Histamine</h3>
                                        <p class="edication-details">500mg Tablet - For inflammation</p>
                                    </div>
                                    <span class="medication-time">Evening</span>
                                </li>
                                <li class="medication-item">
                                    <div>
                                        <h3 class="medication-name">Lisinorphil</h3>
                                        <p class="edication-details">20mg Tablet - For Blood Pressure</p>
                                    </div>
                                    <span class="medication-time">Morning</span>
                                </li>
                                <li class="medication-item">
                                    <div>
                                        <h3 class="medication-name">Aspirin</h3>
                                        <p class="edication-details">81mg Tablet - Blood Thinnner</p>
                                    </div>
                                    <span class="medication-time">Bedtime</span>
                                </li>
                            </ul>
                        </section>
                        <section id="history" class="data-section">
                            <h2 class="section-header">Medical History</h2>
                            <div class="history-item">
                                <p class="history-date">15 March 2025</p>
                                <h3 class="history-diagnosis">Type 2 Diabetes</h3>
                                <p class="history-description">Diagnosed in 2022. Managed with diet and exercise.</p>
                            </div>
                            <div class="history-item">
                                <p class="history-date">5 January 2023</p>
                                <h3 class="history-diagnosis">Hyper Lipidemia</h3>
                                <p class="history-description">Elevated LDL Cholesterol, last LDL was 110mg/dL</p>
                            </div>
                            <div class="history-item">
                                <p class="history-date">18 November 2022</p>
                                <h3 class="history-diagnosis">Hypertension</h3>
                                <p class="history-description">Blood Pressure consistently elevated. Started BP Tablet, well controlled now. </p>
                            </div>
                            <div class="history-item">
                                <p class="history-date">27 February 2019</p>
                                <h3 class="history-diagnosis">Penicillin Allergy</h3>
                                <p class="history-description">Developed Rash and infection after taking penicillin.</p>
                            </div>
                        </section>
                        <section id="lab" class="data-section">
                            <h2 class="section-header">Lab Results</h2>
                            <div class="data-grid">
                                <div class="data-card">
                                    <h3 class="card-title">Haemoglobin A1c</h3>
                                    <p class="card-value">6.8 <span class="card-unit">%</span></p>
                                    <p class="card-status"><i class="fas fa-exclamation-triangle" style="color: var(--warning-color);"></i>Elevated</p>
                                </div>
                                <div class="data-card">
                                    <h3 class="card-title" >LDL Cholestrol</h3>
                                    <p class="card-value">110 <span class="card-unit">mg/dL</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i>Controlled</p>
                                </div>
                                <div class="data-card">
                                    <h3 class="card-title">Creatinine</h3>
                                    <p class="card-value">1.0 <span class="card-unit">mg/dL</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i>Normal</p>
                                </div>
                                <div class="data-card">
                                    <h3 class="card-title">WBC Count</h3>
                                    <p class="card-value">6.5 <span class="card-unit">x10³/µL</span></p>
                                    <p class="card-status"><i class="fas fa-check-circle" style="color: var(--success-color);"></i>Normal</p>
                                </div>
                            </div>
                        </section>

                        <section id="appointments" class="data-section">
                            <h2 class="section-header">Upcoming Appointments</h2>
                            <div class="history-item">
                                <p class="history-date">may 26, 2024- 10:45 AM</p>
                                <h3 class="history-diagnosis"> Dr. Supriya Das- Endochronology</h3>
                                <p class="history-description">Follow up for diabetes management and medication review.</p>
                            </div>
                            <div class="history-item">
                                 <p class="history-date">june 20, 2025- 10:45 AM</p>
                                <h3 class="history-diagnosis"> Dr. Ankita Shah - Cardiology</h3>
                                <p class="history-description">Annual Cardiac evaluation and stress test.</p>
                            </div>
                        </section>
                        <section id="emergency" class="data-section">
                            <h2 class="section-header">Emergency Protocol</h2>
                            <div class="emergency-card">
                                <i class="fas fa-bell" style="font-size: 3rem; color: var(--danger-color);"></i>
                                <h3>Emergency Alert Activated</h3>
                                <p>Medical team has been notified help is on the way.</p>
                                <button class="emergency-cancel">Cancel Alert</button>
                            </div>
                        </section>
                    </div>
                </div>
                </main>
                <div id="status">System Ready</div>
                <div id="gestureIndicator" class="gesture-indicator">
                    <i class="fas fa-hand-paper">Gesture Detected: None</i>
                </div>
                <div id="voiceIndicator" class="voice-indicator">
                    <i class="fas fa-microphone">Listening...</i>
                </div>
                <video id="gestureCam" autoplay muted playsinline></video>

                <div class="gesture-info">
                    <h3> <i class="fas fa-gesture"></i>Gesture Guide</h3>
                    <ul>
                        <li><strong>Swipe Left</strong> Previous Section</li>
                        <li><strong>Swipe Right</strong>Next Section</li>
                        <li><strong>Swipe Up</strong> Emergency Alert</li>
                        <li><strong>Hand Wave</strong>Toggle Gesture Control</li>
                    </ul>

                </div>
                <canvas id="motionCanvas" style="display: none;"></canvas>
            </div>
            
        <!-- <script src="script.js"></script> -->
            <script async src="https://docs.opencv.org/4.5.5/opencv.js" onload="onOpenCvReady();"></script>
    <script>
const sections = ["vitals", "medications", "history", "lab", "appointments", "emergency"];
let currentSection = 0;
let isVoiceActive = false;
let isGestureActive = false;
let lastGestureTime = 0;
const gestureCooldown = 800;

const statusEl = document.getElementById("status");
const voiceBtn = document.getElementById("voiceToggle");
const gestureBtn = document.getElementById("gestureToggle");
const gestureIndicator = document.getElementById("gestureIndicator");
const voiceIndicator = document.getElementById("voiceIndicator");
const navItems = document.querySelectorAll(".nav-item");
const video = document.getElementById("gestureCam");
const emergencyCancelBtn = document.querySelector(".emergency-cancel");
const emergencyBtn = document.getElementById("emergencyBtn");
const motionCanvas = document.getElementById("motionCanvas");
const ctx = motionCanvas.getContext('2d');

let prevFrame = null;
let prevCentroid = null;
let stream = null;
let isOpenCvReady = false;

//voice control
const SpeechRecognition=window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition= new SpeechRecognition();
recognition.continuous = true;
recognition.interimResults=false;
recognition.lang='en-US';
//VOICE COMMAND PROCESSOR
recognition.onresult= (event) =>{
    const command = event.results[event.results.length-1][0].transcript.trim().toLowerCase();
    voiceIndicator.textContent= `Heard: ${command}`;
    //COMMAND ROUTING
    if(command.includes("next")||command.includes("right")){
    navigate(1);
    }else if(command.includes("previous")||command.includes("back")||command.includes("left")){
    navigate(-1);
    }else if(command.includes("vitals")){
    jumpToSection("vitals");
    }else if(command.includes("medications")){
    jumpToSection("medications");
    }else if(command.includes("history")){
    jumpToSection("history");
    }else if(command.includes("lab")){
    jumpToSection("lab");
    }else if(command.includes("appointments")){ 
    jumpToSection("appointments");
    }else if(command.includes("emergency")){
    jumpToSection("emergency");
    }else if(command.includes("enable voice")){
    startVoiceControl();
    }else if(command.includes("disable voice")){
    stopVoiceControl();
    }
};
//VOICE CONTROL TOGGLE
voiceBtn.addEventListener("click",toggleVoiceControl);
function toggleVoiceControl(){
    if(!isVoiceActive){
        startVoiceControl();
    } else {
        stopVoiceControl();
    }
}
function startVoiceControl(){
    recognition.start();
    isVoiceActive = true;
    voiceBtn.classList.add("active");
    voiceIndicator.style.display = "flex";
    speak("Voice Control Enabled");
    statusEl.textContent = "Voice: Listening...";
}

function stopVoiceControl(){
    recognition.stop();
    isVoiceActive = false;
    voiceBtn.classList.remove("active");
    voiceIndicator.style.display = "none";
    statusEl.textContent = "Voice: Off";
}



function onOpenCvReady(){
    console.log('OpenCV.js is ready!');
    isOpenCvReady = true;
    motionCanvas.width = 320;
    motionCanvas.height = 240;
}
function processVideo(){
    if(!isGestureActive || !isOpenCvReady) return;
    try{
        ctx.drawImage(video, 0, 0, motionCanvas.width, motionCanvas.height);
        const currentFrame = cv.imread(motionCanvas);
        const gray = new cv.Mat();
        cv.cvtColor(currentFrame, gray, cv.COLOR_RGBA2GRAY);
        if(prevFrame){
            const diff = new cv.Mat();
            cv.absdiff(gray, prevFrame, diff);
            const thresh = new cv.Mat();
            cv.threshold(diff, thresh, 25, 255, cv.THRESH_BINARY);
            const contours = new cv.MatVector();
            const hierarchy = new cv.Mat();
            cv.findContours(thresh, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);
            let maxArea = 0;
            let maxContour = null;
            for (let i = 0; i < contours.size(); i++){
                const contour = contours.get(i);
                const area = cv.contoursArea(contour);
                if (area > maxArea){
                    maxArea = area;
                    maxContour = contour;
                }
            }
            //Significant Motion is detected
            if (maxArea>500){
                const now = Date.now();
                if(now - lastGestureTime > gestureCooldown){
                    const moments = cv.moments(maxContour);
                    const cx = moments.m10 / moments.m00;
                    const cy = moments.m01 / moments.m00;

                    if(prevCentroid){
                        const dx = cx - prevCentroid.x;
                        const dy = cy - prevCentroid.y;
                        if(Math.abs(dx)>Math.abs(dy)){
                            if(dx>10){
                                showGestureFeedback("👉 Swipe Right (Next)");
                                navigate(1);
                            }
                            else if(dx <-10){
                                showGestureFeedback("👈 Swipe Left (Previous)");
                                navigate(-1);
                            }
                            } else {
                                if(dy < -10){
                                    showGestureFeedback("Emergency Activated!");
                                    jumpToSection("emergency");
                                    triggerEmergency();
                                }
                            }
                        }
                        prevCentroid = {x : cx, y : cy};
                    }
                }
                diff.delete();
                thresh.delete();
                contours.delete();
                hierarchy.delete();
            }
            prevFrame = gray.clone();
            currentFrame.delete();
            gray.delete();
        } catch(err){
            console.error('Error processing frame: ', err);
        }
        requestAnimationFrame(processVideo);
    }
    function showGestureFeedback(text){
        gestureIndicator.textContent = text;
        lastGestureTime = Date.now();
    }
    gestureBtn.addEventListener("click", toggleGestureControl);

    function toggleGestureControl(){
        if (!isGestureActive){
            startGestureControl();
        } else {
            stopGestureControl();
        }
    }

    function startGestureControl() {
        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({video: true, audio: false})
            .then(function (mediaStream){
                stream = mediaStream;
                video.srcObject = stream;
                video.play();

                video.onplaying = function() {
                    isGestureActive = true;
                    gestureBtn.classList.add("active");
                    gestureIndicator.style.display = "flex";
                    speak("Gesture control enabled");
                    statusEl.textContent ="Gestures: Active";
                    processVideo();
                };
            })
            .catch(function (err){
                console.log("Could not access camera: " + err);
                gestureIndicator.textContent = "❌ Camera blocked";
            });
        } else {
            alert("Your browser doesn't support camera access");
        }
    }

    function stopGestureControl() {
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
            stream = null;
        }
        if (prevFrame){
            prevFrame.delete();
            prevFrame = null;
        }
        prevCentroid = null;
        isGestureActive = false;
        gestureBtn.classList.remove("active");
        gestureIndicator.style.display ="none";
        statusEl.textContent = "Gestures: Off";
    }

     navItems.forEach(item => {
        item.addEventListener('click', () => {
            const section = item.getAttribute('data-section');
                jumpToSection(section);

                if (section === 'emergency') {
                    triggerEmergency();
                }
        });
     });

     function navigate(direction) {
        currentSection = (currentSection + direction + sections.length) % sections.length; 
        updateSection();
        speak(`Showing ${sections[currentSection]}`);
     }

     function jumpToSection(sectionName) {
        currentSection = sections.indexOf(sectionName);
        updateSection();
        speak(`Showing ${sectionName}`);
     }

     function updateSection() {
        document.querySelectorAll(".data-section").forEach((el, i) => {
            el.classList.toggle("active", i === currentSection);
        });
        navItems.forEach((item, i) => {
            item.classList.toggle("active", i === currentSection);
        });
     }
     function triggerEmergency() {
        jumpToSection("emergency");
        speak("Emergency alert activated! Help is on the way.");
        statusEl.textContent = "EMERGENCY ALERT!";
        statusEl.style.backgroundColor = "var(--danger-color)";
        statusEl.style.color = "white";
        document.body.style.animation = "emergencyFlash 0.5s infinite";

        setTimeout(() => {
            resetEmergency();
        }, 1000);
     }

     function resetEmergency(){
        statusEl.textContent = "System Ready";
        statusEl.style.background ="";
        statusEl.style.color = "";
        document.body.style.animation = "";
     }

     if (emergencyCancelBtn) {
        emergencyCancelBtn.addEventListener("click", resetEmergency);
     }

     if (emergencyBtn) {
        emergencyBtn.addEventListener("click", triggerEmergency);
     }

     function speak(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 1.0;
        window.speechSynthesis.speak(utterance);
     }

     document.addEventListener("DOMContentLoaded", () => {
        updateSection();

        const style = document.createElement("style");
        style.textContent = `
        @keyframes emergencyFlash {
        0%, 100% {background-color: inherit; }
        50% { background-color: rgba(220,53,69,0.3);}

        }`;
        document.head.appendChild(style);
     });



    </script>
</body>
</html>